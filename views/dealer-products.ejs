<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Dealer Products | Vendor Dashboard</title>
  <link rel="icon" type="image/png" href="/image/favicon.png">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <link href="https://fonts.googleapis.com/css2?family=Merienda&display=swap" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Lexend:wght@100..900&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/vendor-dashboard.css">
</head>

<body>
  <%- include('partial/sidebar') %>
    <%- include('partial/header') %>

      <main class="container">

        <!-- Annatra Main Shop Container Begin -->
        <div class="main-shop-container">

          <!-- Content Area: Search bar & Products Grid -->
          <div id="shop-content" class="flex-grow-1">
            <!-- <div> -->
              
              <% if (message) { %>
                <div class="alert alert-danger">
                  <%= message %>
                </div>
                <% } else { %>
                <div id="dealer-container">
                  <p style="margin: 15px 20px; font-size: 1.3rem;">Available Dealers Near You</p>
                  <div class="searchBar-container">
                    <input type="text" id="searchBar1" class="form-control form-control-lg"
                      placeholder="Search for dealers...">
                  </div>
                  <div class="dealer-wrapper">

                    <% dealers.forEach(dealer=> { %>
                      <div class="card p-3 shadow-sm dealer-card" data-name="<%= dealer.name %>">
                        <div
                          style="display: flex; flex-direction: row; justify-content: flex-start; align-items: center;">
                          <img src="<%= dealer.decodedImage %>" alt=""
                            style="height: 50px; width: 50px; margin: 0px 10px 10px 0px;">
                          <h5>
                            <%= dealer.name %>
                          </h5>
                        </div>
                        <p>Email: <%= dealer.email %>
                        </p>
                        <p>ID: <%= dealer._id %>
                        </p>
                        <p>Phone: <%= dealer.phone %>
                        </p>
                        <button class="btn btn-primary view-items-btn" data-dealer-id="<%= dealer._id %>">View
                          Items</button>
                      </div>
                      <% }) %>
                  </div>
                </div>
                <% } %>

                <!-- Products Grid -->
                <div id="productList">
                  <!-- <div> -->
                  <div id="dealer">
                    <span class="d-flex flex-direction-row align-items-center">
                      <div id="dealer-image">
                      </div>
                      <div id="dealer-info">
                      </div>
                    </span>
                    <span id="remove-currentDealer">
                      <i class="fa-solid fa-xmark" style="font-size: 1.2rem; cursor: pointer;"></i>
                    </span>
                    <!-- <div class="btn btn-success" style="font-size: 0.8rem; margin-left: 10px;">
                  Back
                </div> -->
                  </div>
                  <!-- Search Bar -->
                  <div class="searchBar-container">
                    <input type="text" id="searchBar2" class="form-control form-control-lg"
                      placeholder="Search for products...">
                  </div>
                  <div id="products-container">
                    <!-- JS will append product cards here -->
                  </div>
                </div>
          </div>

          <!-- Cart Sidebar -->
          <aside id="cartSidebar" class="cart-sidebar">
            <h5 class="mb-3"><i class="fa-solid fa-cart-shopping"></i> Your Cart</h5>
            <ul id="cartItems" class="list-group mb-1">
              <% if (user.cart && user.cart.length> 0) { %>
                <% user.cart.forEach(item=> { %>
                  <li class="list-group-item d-flex justify-content-between align-items-center">
                    <div class="list-group-item-div">
                      <div>
                        <strong>
                          <%= item.item %>
                        </strong><br>
                        <small>Price: ₹<%= item.price %> | Qty: <%= item.quantity %></small>
                      </div>
                    </div>
                    <span>₹<%= item.price * item.quantity %></span>
                  </li>
                  <% }); %>
                    <% } else { %>
                      <li class="list-group-item text-muted">Your cart is empty</li>
                      <% } %>
            </ul>
            <h6>Total: ₹<span id="totalPrice">
                <%= cartTotal || 0 %>
              </span></h6>
            <button id="saveCartBtn" class="btn btn-success w-100 mt-3">Place Order</button>
          </aside>
        </div>
      </main>

      <%- include('partial/footer') %>
        <script>
          window.currentDealer = "<%= user.currentDealer %>";
        </script>
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
        <script src="/js/dealer-products.js"></script>
</body>

</html>